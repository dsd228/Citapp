<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conexión Privada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }
        .profile-card {
            transition: all 0.2s ease;
            border: 1px solid #334155;
            background: linear-gradient(135deg, #1e293b, #334155);
        }
        .profile-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .online-status {
            width: 8px;
            height: 8px;
            background-color: #10B981;
            border-radius: 50%;
            display: inline-block;
            margin-right: 4px;
        }
        .distance-badge {
            background: linear-gradient(90deg, #6366F1, #8B5CF6);
            color: white;
            font-weight: 500;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 20px;
        }
        .app-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #6366F1, #8B5CF6);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        .tab-active {
            color: #6366F1;
            font-weight: 600;
            border-bottom-2 border-purple-600;
        }
        .tab-inactive {
            color: #94a3b8;
        }
        .badge {
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 12px;
            font-weight: 500;
        }
        .interest-badge {
            background-color: #334155;
            color: #e2e8f0;
            border: 1px solid #475569;
        }
        .verified-badge {
            background: linear-gradient(90deg, #10B981, #059669);
            color: white;
        }
        .action-btn {
            transition: all 0.2s ease;
        }
        .action-btn:hover {
            transform: scale(1.1);
        }
        .chat-bubble {
            background: linear-gradient(135deg, #6366F1, #8B5CF6);
            color: white;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 12px;
            display: inline-block;
            margin-left: 4px;
        }
        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 4px;
        }
        .status-online {
            background-color: #10B981;
        }
        .status-away {
            background-color: #F59E0B;
        }
        .status-offline {
            background-color: #6B7280;
        }
        .search-input:focus {
            border-color: #8B5CF6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
        }
        .modal-content {
            background-color: #1e293b;
            margin: 5% auto;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border: 1px solid #334155;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #e2e8f0;
            font-weight: 500;
        }
        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #334155;
            border-radius: 0.5rem;
            background-color: #334155;
            color: #e2e8f0;
            font-size: 0.875rem;
        }
        .form-control:focus {
            outline: none;
            border-color: #6366F1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
        }
        .checkbox-item input[type="checkbox"] {
            margin-right: 0.5rem;
        }
        .btn-primary {
            background: linear-gradient(135deg, #6366F1, #8B5CF6);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        .btn-secondary {
            background-color: #334155;
            color: #e2e8f0;
            border: 1px solid #475569;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
        }
        .btn-danger {
            background-color: #DC2626;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
        }
        .tribu-badge {
            background: linear-gradient(45deg, #8B5CF6, #EC4899);
            color: white;
            font-weight: 500;
        }
        .rol-badge {
            background: linear-gradient(45deg, #059669, #10B981);
            color: white;
            font-weight: 500;
        }
        .preferencia-badge {
            background: linear-gradient(45deg, #F59E0B, #D97706);
            color: white;
            font-weight: 500;
        }
    </style>
</head>
<body class="bg-gray-900">
    <div id="app">
        <!-- Header -->
        <header class="bg-gray-800 border-b border-gray-700 shadow-sm">
            <div class="max-w-md mx-auto px-4 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="app-icon">C</div>
                        <div>
                            <h1 class="text-lg font-semibold text-white">Conexión</h1>
                            <p class="text-xs text-gray-400">Privada & Segura</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="notificationsBtn" class="p-2 text-gray-400 hover:text-white relative">
                            <i class="fas fa-bell text-sm"></i>
                            <span id="notificationCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">0</span>
                        </button>
                        <button id="profileBtn" class="p-2 text-gray-400 hover:text-white">
                            <i class="fas fa-user text-sm"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Pestañas de navegación -->
        <div class="max-w-md mx-auto bg-gray-800 border-b border-gray-700">
            <div class="flex">
                <button id="tabNearby" class="tab-active flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1">
                    <i class="fas fa-users text-purple-400"></i>
                    <span>Cercanos</span>
                </button>
                <button id="tabMessages" class="tab-inactive flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1">
                    <i class="fas fa-comments text-gray-400"></i>
                    <span>Mensajes</span>
                </button>
                <button id="tabProfile" class="tab-inactive flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1">
                    <i class="fas fa-user text-gray-400"></i>
                    <span>Mi Perfil</span>
                </button>
            </div>
        </div>

        <!-- Contenido principal -->
        <main class="max-w-md mx-auto">
            <!-- Barra de búsqueda y filtros -->
            <div class="p-4 bg-gray-800 border-b border-gray-700">
                <div class="relative mb-3">
                    <input type="text" id="searchInput" placeholder="Buscar..." class="w-full pl-10 pr-4 py-2 border border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm search-input bg-gray-700 text-white placeholder-gray-400">
                    <div class="absolute left-3 top-2.5 text-gray-400">
                        <i class="fas fa-search text-sm"></i>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button id="filterBtn" class="flex-1 bg-gray-700 text-gray-300 text-xs py-2 px-3 rounded-lg flex items-center justify-center space-x-1">
                        <i class="fas fa-sliders-h text-xs"></i>
                        <span>Filtros</span>
                    </button>
                    <button id="sortBtn" class="flex-1 bg-purple-900 text-purple-200 text-xs py-2 px-3 rounded-lg flex items-center justify-center space-x-1">
                        <i class="fas fa-sort text-xs"></i>
                        <span>Distancia</span>
                    </button>
                </div>
            </div>

            <!-- Lista de perfiles -->
            <div id="profilesContainer" class="bg-gray-800">
                <!-- Los perfiles se generarán dinámicamente -->
            </div>

            <!-- Footer informativo -->
            <div class="p-4 bg-gray-800 border-t border-gray-700">
                <div class="flex items-center justify-center text-xs text-gray-400 space-x-4">
                    <span id="locationStatus">📍 Ubicación: Desactivada</span>
                    <span>•</span>
                    <span id="userCount">👥 0 usuarios cerca</span>
                </div>
            </div>
        </main>

        <!-- Modal de inicio de sesión/registro -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <div class="text-center mb-6">
                    <div class="app-icon mx-auto mb-3">C</div>
                    <h2 class="text-2xl font-bold text-white">Bienvenido</h2>
                    <p class="text-gray-300 mt-2">Completa tu perfil para conectar con personas compatibles</p>
                </div>
                <form id="profileForm">
                    <div class="form-group">
                        <label class="form-label" for="nombre">Nombre</label>
                        <input class="form-control" id="nombre" type="text" placeholder="Tu nombre" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="edad">Edad</label>
                        <select id="edad" class="form-control" required>
                            <option value="">Selecciona tu edad</option>
                            <option value="18-25">18-25</option>
                            <option value="26-35">26-35</option>
                            <option value="36-45">36-45</option>
                            <option value="46-55">46-55</option>
                            <option value="56+">56+</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Género</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" name="genero" value="Hombre"> Hombre
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="genero" value="Transexual"> Transexual
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="genero" value="No binario"> No binario
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Rol</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" name="rol" value="Pasivo"> Pasivo
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="rol" value="Activo"> Activo
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="rol" value="Versátil"> Versátil
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tribus</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Bears"> Bears
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Leather"> Leather
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Twink"> Twink
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Jock"> Jock
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Otaku"> Otaku
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Goth"> Goth
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Raver"> Raver
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Muscular"> Muscular
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Preferencias</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Anal"> Anal
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Oral"> Oral
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Masturbación"> Masturbación
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Sadomaso"> Sadomaso
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Grupal"> Grupal
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Fisting"> Fisting
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Juegos de roles"> Juegos de roles
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Exhibicionismo"> Exhibicionismo
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="descripcion">Descripción (opcional)</label>
                        <textarea id="descripcion" class="form-control" rows="3" placeholder="Cuéntanos sobre ti..."></textarea>
                    </div>
                    
                    <div class="flex space-x-2 pt-2">
                        <button type="submit" class="btn-primary flex-1">
                            <i class="fas fa-user-plus mr-2"></i> Crear Perfil
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de perfil -->
        <div id="profileModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white">Mi Perfil</h2>
                    <button id="closeProfile" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="profileContent">
                    <!-- El contenido del perfil se generará dinámicamente -->
                </div>
                <div class="flex space-x-2 mt-4">
                    <button id="editProfileBtn" class="btn-secondary flex-1">
                        <i class="fas fa-edit mr-2"></i> Editar
                    </button>
                    <button id="logoutBtn" class="btn-danger">
                        <i class="fas fa-sign-out-alt mr-2"></i> Salir
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de edición de perfil -->
        <div id="editProfileModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white">Editar Perfil</h2>
                    <button id="closeEditProfile" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="editProfileForm">
                    <div class="form-group">
                        <label class="form-label" for="editNombre">Nombre</label>
                        <input class="form-control" id="editNombre" type="text" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="editEdad">Edad</label>
                        <select id="editEdad" class="form-control" required>
                            <option value="18-25">18-25</option>
                            <option value="26-35">26-35</option>
                            <option value="36-45">36-45</option>
                            <option value="46-55">46-55</option>
                            <option value="56+">56+</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Género</label>
                        <div class="checkbox-group" id="editGenero">
                            <label class="checkbox-item">
                                <input type="checkbox" name="genero" value="Hombre"> Hombre
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="genero" value="Transexual"> Transexual
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="genero" value="No binario"> No binario
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Rol</label>
                        <div class="checkbox-group" id="editRol">
                            <label class="checkbox-item">
                                <input type="checkbox" name="rol" value="Pasivo"> Pasivo
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="rol" value="Activo"> Activo
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="rol" value="Versátil"> Versátil
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tribus</label>
                        <div class="checkbox-group" id="editTribu">
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Bears"> Bears
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Leather"> Leather
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Twink"> Twink
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Jock"> Jock
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Otaku"> Otaku
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Goth"> Goth
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Raver"> Raver
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Muscular"> Muscular
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Preferencias</label>
                        <div class="checkbox-group" id="editPreferencia">
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Anal"> Anal
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Oral"> Oral
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Masturbación"> Masturbación
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Sadomaso"> Sadomaso
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Grupal"> Grupal
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Fisting"> Fisting
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Juegos de roles"> Juegos de roles
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Exhibicionismo"> Exhibicionismo
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="editDescripcion">Descripción</label>
                        <textarea id="editDescripcion" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="flex space-x-2 pt-2">
                        <button type="button" id="cancelEdit" class="btn-secondary flex-1">Cancelar</button>
                        <button type="submit" class="btn-primary flex-1">Guardar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de filtros -->
        <div id="filterModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white">Filtros</h2>
                    <button id="closeFilter" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="space-y-4">
                    <div class="form-group">
                        <label class="form-label">Distancia máxima</label>
                        <select id="distanceFilter" class="form-control">
                            <option value="5">Hasta 5 km</option>
                            <option value="10" selected>Hasta 10 km</option>
                            <option value="25">Hasta 25 km</option>
                            <option value="50">Hasta 50 km</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rango de edad</label>
                        <select id="ageFilter" class="form-control">
                            <option value="all">Todas las edades</option>
                            <option value="18-25">18-25 años</option>
                            <option value="26-35" selected>26-35 años</option>
                            <option value="36-45">36-45 años</option>
                            <option value="46+">46+ años</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Género</label>
                        <div class="checkbox-group" id="filterGenero">
                            <label class="checkbox-item">
                                <input type="checkbox" name="genero" value="Hombre"> Hombre
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="genero" value="Transexual"> Transexual
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="genero" value="No binario"> No binario
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rol</label>
                        <div class="checkbox-group" id="filterRol">
                            <label class="checkbox-item">
                                <input type="checkbox" name="rol" value="Pasivo"> Pasivo
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="rol" value="Activo"> Activo
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="rol" value="Versátil"> Versátil
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tribus</label>
                        <div class="checkbox-group" id="filterTribu">
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Bears"> Bears
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Leather"> Leather
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Twink"> Twink
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Jock"> Jock
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Otaku"> Otaku
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Goth"> Goth
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Raver"> Raver
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="tribu" value="Muscular"> Muscular
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Preferencias</label>
                        <div class="checkbox-group" id="filterPreferencia">
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Anal"> Anal
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Oral"> Oral
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Masturbación"> Masturbación
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Sadomaso"> Sadomaso
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Grupal"> Grupal
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Fisting"> Fisting
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Juegos de roles"> Juegos de roles
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="preferencia" value="Exhibicionismo"> Exhibicionismo
                            </label>
                        </div>
                    </div>
                    <div class="flex space-x-2 pt-2">
                        <button id="applyFilters" class="btn-primary flex-1">Aplicar</button>
                        <button id="resetFilters" class="btn-secondary flex-1">Restablecer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de notificaciones -->
        <div id="notificationsModal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white">Notificaciones</h2>
                    <button id="closeNotifications" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="notificationsList">
                    <!-- Las notificaciones se generarán dinámicamente -->
                </div>
                <button id="markAllRead" class="w-full mt-4 text-purple-400 text-sm font-medium py-2">
                    Marcar todo como leído
                </button>
            </div>
        </div>
    </div>

    <script>
        // Datos del usuario actual
        let currentUser = null;
        let users = [];
        let notifications = [];
        let userLocation = null;
        let locationEnabled = false;
        let filters = {
            distance: 10,
            age: '26-35',
            genero: [],
            rol: [],
            tribu: [],
            preferencia: []
        };

        // Elementos del DOM
        const loginModal = document.getElementById('loginModal');
        const profileModal = document.getElementById('profileModal');
        const editProfileModal = document.getElementById('editProfileModal');
        const filterModal = document.getElementById('filterModal');
        const notificationsModal = document.getElementById('notificationsModal');
        const profilesContainer = document.getElementById('profilesContainer');
        const locationStatus = document.getElementById('locationStatus');
        const userCount = document.getElementById('userCount');
        const notificationCount = document.getElementById('notificationCount');
        const searchInput = document.getElementById('searchInput');

        // Mostrar modal de login al cargar si no hay usuario
        window.onload = function() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                checkLocationPermission();
            } else {
                loginModal.style.display = 'block';
            }
            generateMockUsers();
            renderProfiles();
            renderNotifications();
        };

        // Formulario de perfil
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nombre = document.getElementById('nombre').value;
            const edad = document.getElementById('edad').value;
            
            // Obtener arrays de checkboxes
            const genero = Array.from(document.querySelectorAll('input[name="genero"]:checked')).map(cb => cb.value);
            const rol = Array.from(document.querySelectorAll('input[name="rol"]:checked')).map(cb => cb.value);
            const tribu = Array.from(document.querySelectorAll('input[name="tribu"]:checked')).map(cb => cb.value);
            const preferencia = Array.from(document.querySelectorAll('input[name="preferencia"]:checked')).map(cb => cb.value);
            const descripcion = document.getElementById('descripcion').value;
            
            // Validaciones
            if (genero.length === 0) {
                alert('Por favor selecciona al menos un género');
                return;
            }
            if (rol.length === 0) {
                alert('Por favor selecciona al menos un rol');
                return;
            }
            if (tribu.length === 0) {
                alert('Por favor selecciona al menos una tribu');
                return;
            }
            if (preferencia.length === 0) {
                alert('Por favor selecciona al menos una preferencia');
                return;
            }

            currentUser = {
                id: Date.now().toString(),
                nombre: nombre,
                edad: edad,
                genero: genero,
                rol: rol,
                tribu: tribu,
                preferencia: preferencia,
                descripcion: descripcion,
                createdAt: new Date().toISOString(),
                lastActive: new Date().toISOString()
            };

            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            loginModal.style.display = 'none';
            
            checkLocationPermission();
            generateMockUsers();
            renderProfiles();
        });

        // Verificar permiso de ubicación
        function checkLocationPermission() {
            if (navigator.geolocation) {
                navigator.permissions.query({name: 'geolocation'}).then(function(result) {
                    if (result.state === 'granted') {
                        updateUserLocation();
                        locationEnabled = true;
                        locationStatus.textContent = '📍 Ubicación: Activada';
                    } else if (result.state === 'prompt') {
                        requestLocationPermission();
                    } else {
                        locationStatus.textContent = '📍 Ubicación: Denegada';
                        alert('Para una mejor experiencia, por favor activa la ubicación en tu navegador');
                    }
                });
            } else {
                locationStatus.textContent = '📍 Ubicación: No soportada';
                alert('Tu navegador no soporta geolocalización');
            }
        }

        // Solicitar permiso de ubicación
        function requestLocationPermission() {
            if (confirm('¿Permitir acceso a tu ubicación para encontrar personas cercanas?')) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            timestamp: new Date().toISOString()
                        };
                        locationEnabled = true;
                        locationStatus.textContent = '📍 Ubicación: Activada';
                        updateUserLocation();
                        renderProfiles();
                    },
                    function(error) {
                        console.log('Error de geolocalización:', error);
                        locationStatus.textContent = '📍 Ubicación: Denegada';
                        alert('No se pudo obtener tu ubicación. Por favor actívala en la configuración de tu navegador.');
                    },
                    {timeout: 10000, maximumAge: 60000}
                );
            } else {
                locationStatus.textContent = '📍 Ubicación: Desactivada';
            }
        }

        // Actualizar ubicación del usuario
        function updateUserLocation() {
            if (navigator.geolocation && locationEnabled) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            timestamp: new Date().toISOString()
                        };
                        locationEnabled = true;
                        locationStatus.textContent = '📍 Ubicación: Activada';
                        renderProfiles();
                    },
                    function(error) {
                        console.log('Error al actualizar ubicación:', error);
                    },
                    {timeout: 5000, maximumAge: 30000}
                );
            }
        }

        // Calcular distancia entre dos puntos (fórmula de Haversine)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radio de la Tierra en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            return distance;
        }

        // Generar usuarios de prueba
        function generateMockUsers() {
            const nombres = ['Andrés', 'Carlos', 'Daniel', 'Eduardo', 'Felipe', 'Gabriel', 'Hugo', 'Iván', 'Javier', 'Luis', 'Miguel', 'Nicolás', 'Oscar', 'Pablo', 'Raúl', 'Sergio', 'Tomás', 'Víctor', 'Xavier', 'Yago'];
            const ciudades = ['Madrid', 'Barcelona', 'Valencia', 'Sevilla', 'Bilbao', 'Málaga', 'Zaragoza', 'Murcia', 'Palma', 'Alicante'];
            const generos = ['Hombre', 'Transexual', 'No binario'];
            const roles = ['Pasivo', 'Activo', 'Versátil'];
            const tribus = ['Bears', 'Leather', 'Twink', 'Jock', 'Otaku', 'Goth', 'Raver', 'Muscular'];
            const preferencias = ['Anal', 'Oral', 'Masturbación', 'Sadomaso', 'Grupal', 'Fisting', 'Juegos de roles', 'Exhibicionismo'];
            
            users = [];
            
            for (let i = 0; i < 25; i++) {
                // Generar ubicación aleatoria cercana al usuario (si está disponible)
                let lat, lng;
                if (userLocation) {
                    // Variación de ±0.1 grados (aproximadamente ±11 km)
                    lat = userLocation.lat + (Math.random() - 0.5) * 0.2;
                    lng = userLocation.lng + (Math.random() - 0.5) * 0.2;
                } else {
                    // Ubicación aleatoria en España
                    lat = 40 + (Math.random() - 0.5) * 10;
                    lng = -4 + (Math.random() - 0.5) * 10;
                }
                
                const numGeneros = 1 + Math.floor(Math.random() * 2); // 1-2 géneros
                const numRoles = 1 + Math.floor(Math.random() * 2); // 1-2 roles
                const numTribus = 1 + Math.floor(Math.random() * 3); // 1-3 tribus
                const numPreferencias = 2 + Math.floor(Math.random() * 4); // 2-5 preferencias
                
                const userGeneros = [];
                const userRoles = [];
                const userTribus = [];
                const userPreferencias = [];
                
                const shuffledGeneros = [...generos].sort(() => 0.5 - Math.random());
                const shuffledRoles = [...roles].sort(() => 0.5 - Math.random());
                const shuffledTribus = [...tribus].sort(() => 0.5 - Math.random());
                const shuffledPreferencias = [...preferencias].sort(() => 0.5 - Math.random());
                
                for (let j = 0; j < numGeneros; j++) {
                    userGeneros.push(shuffledGeneros[j]);
                }
                for (let j = 0; j < numRoles; j++) {
                    userRoles.push(shuffledRoles[j]);
                }
                for (let j = 0; j < numTribus; j++) {
                    userTribus.push(shuffledTribus[j]);
                }
                for (let j = 0; j < numPreferencias; j++) {
                    userPreferencias.push(shuffledPreferencias[j]);
                }
                
                users.push({
                    id: `user${i}`,
                    nombre: nombres[i % nombres.length],
                    edad: 22 + Math.floor(Math.random() * 25),
                    ciudad: ciudades[i % ciudades.length],
                    genero: userGeneros,
                    rol: userRoles,
                    tribu: userTribus,
                    preferencia: userPreferencias,
                    descripcion: `Hola, soy ${nombres[i % nombres.length]} y me encanta conocer gente nueva. Busco conexiones reales y momentos especiales.`,
                    lat: lat,
                    lng: lng,
                    lastActive: new Date(Date.now() - Math.random() * 3600000).toISOString(), // Última actividad en la última hora
                    verified: Math.random() > 0.7,
                    avatar: `https://placehold.co/80x80/${['6366F1', '8B5CF6', 'EC4899', '10B981', 'F59E0B', '059669', 'DC2626', '7C3AED'][i % 8]}/white?text=${nombres[i % nombres.length][0]}`
                });
            }
        }

        // Filtrar y ordenar perfiles
        function getFilteredProfiles() {
            if (!userLocation || !currentUser) return [];

            let filtered = users.filter(user => {
                const distance = calculateDistance(userLocation.lat, userLocation.lng, user.lat, user.lng);
                const ageMatch = filters.age === 'all' || 
                    (filters.age === '18-25' && user.edad >= 18 && user.edad <= 25) ||
                    (filters.age === '26-35' && user.edad >= 26 && user.edad <= 35) ||
                    (filters.age === '36-45' && user.edad >= 36 && user.edad <= 45) ||
                    (filters.age === '46+' && user.edad >= 46);
                
                const distanceMatch = distance <= filters.distance;
                
                const generoMatch = filters.genero.length === 0 || 
                    filters.genero.some(g => user.genero.includes(g));
                
                const rolMatch = filters.rol.length === 0 || 
                    filters.rol.some(r => user.rol.includes(r));
                
                const tribuMatch = filters.tribu.length === 0 || 
                    filters.tribu.some(t => user.tribu.includes(t));
                
                const preferenciaMatch = filters.preferencia.length === 0 || 
                    filters.preferencia.some(p => user.preferencia.includes(p));
                
                // No mostrar al usuario actual
                const notCurrentUser = user.id !== currentUser.id;
                
                return distanceMatch && ageMatch && generoMatch && rolMatch && tribuMatch && preferenciaMatch && notCurrentUser;
            });

            // Aplicar búsqueda
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(user => 
                    user.nombre.toLowerCase().includes(searchTerm) ||
                    user.genero.some(g => g.toLowerCase().includes(searchTerm)) ||
                    user.rol.some(r => r.toLowerCase().includes(searchTerm)) ||
                    user.tribu.some(t => t.toLowerCase().includes(searchTerm)) ||
                    user.preferencia.some(p => p.toLowerCase().includes(searchTerm))
                );
            }

            // Ordenar por distancia
            filtered.sort((a, b) => {
                const distA = calculateDistance(userLocation.lat, userLocation.lng, a.lat, a.lng);
                const distB = calculateDistance(userLocation.lat, userLocation.lng, b.lat, b.lng);
                return distA - distB;
            });

            return filtered;
        }

        // Renderizar perfiles
        function renderProfiles() {
            const filteredProfiles = getFilteredProfiles();
            userCount.textContent = `👥 ${filteredProfiles.length} usuarios cerca`;
            
            profilesContainer.innerHTML = '';
            
            if (filteredProfiles.length === 0) {
                profilesContainer.innerHTML = `
                    <div class="p-8 text-center">
                        <i class="fas fa-user-friends text-4xl text-gray-500 mb-4"></i>
                        <p class="text-gray-400">No hay usuarios cercanos con estos filtros</p>
                    </div>
                `;
                return;
            }
            
            filteredProfiles.forEach(user => {
                const distance = calculateDistance(userLocation.lat, userLocation.lng, user.lat, user.lng);
                const lastActive = new Date(user.lastActive);
                const now = new Date();
                const minutesAgo = Math.floor((now - lastActive) / 60000);
                const hoursAgo = Math.floor(minutesAgo / 60);
                
                let statusText, statusClass, statusDot;
                if (minutesAgo < 5) {
                    statusText = 'En línea ahora';
                    statusClass = 'text-green-400';
                    statusDot = 'status-online';
                } else if (hoursAgo < 1) {
                    statusText = `En línea hace ${minutesAgo} min`;
                    statusClass = 'text-yellow-400';
                    statusDot = 'status-away';
                } else {
                    statusText = `Últ. conexión: ${hoursAgo}h`;
                    statusClass = 'text-gray-400';
                    statusDot = 'status-offline';
                }
                
                const profileHTML = `
                    <div class="profile-card border-b border-gray-700">
                        <div class="flex items-center p-4">
                            <div class="relative mr-4">
                                <img src="${user.avatar}" alt="${user.nombre}" class="w-14 h-14 rounded-2xl object-cover shadow-sm">
                                <span class="absolute -bottom-1 -right-1 status-dot ${statusDot}"></span>
                                ${user.verified ? `<span class="absolute -top-1 -right-1 verified-badge text-xs px-1 py-0.5 rounded-full">
                                    <i class="fas fa-check text-xs"></i>
                                </span>` : ''}
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center mb-1">
                                    <h3 class="text-sm font-semibold text-white truncate">${user.nombre}, ${user.edad}</h3>
                                    <span class="ml-2 distance-badge">${distance.toFixed(1)} km</span>
                                </div>
                                <div class="flex flex-wrap gap-1 mb-2">
                                    ${user.genero.slice(0, 2).map(genero => `
                                        <span class="badge interest-badge">${genero}</span>
                                    `).join('')}
                                    ${user.rol.slice(0, 1).map(rol => `
                                        <span class="badge rol-badge">${rol}</span>
                                    `).join('')}
                                </div>
                                <div class="flex flex-wrap gap-1 mb-2">
                                    ${user.tribu.slice(0, 2).map(tribu => `
                                        <span class="badge tribu-badge">${tribu}</span>
                                    `).join('')}
                                </div>
                                <div class="flex items-center text-xs ${statusClass}">
                                    <span class="status-dot ${statusDot}"></span>
                                    <span>${statusText}</span>
                                </div>
                            </div>
                            <div class="flex flex-col space-y-2 ml-2">
                                <button class="action-btn p-2 text-gray-400 hover:text-purple-400 bg-gray-700 rounded-full like-btn" data-id="${user.id}">
                                    <i class="fas fa-heart text-xs"></i>
                                </button>
                                <button class="action-btn p-2 text-gray-400 hover:text-purple-400 bg-gray-700 rounded-full message-btn" data-id="${user.id}">
                                    <i class="fas fa-comment text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                profilesContainer.innerHTML += profileHTML;
            });
            
            // Añadir eventos a los botones
            document.querySelectorAll('.like-btn').forEach(btn => {
                btn.addEventListener('click', handleLike);
            });
            
            document.querySelectorAll('.message-btn').forEach(btn => {
                btn.addEventListener('click', handleMessage);
            });
        }

        // Manejar "Me gusta"
        function handleLike(e) {
            e.stopPropagation();
            const userId = e.currentTarget.getAttribute('data-id');
            const user = users.find(u => u.id === userId);
            
            // Crear notificación
            const notification = {
                id: Date.now().toString(),
                type: 'like',
                userId: userId,
                userName: user.nombre,
                userAvatar: user.avatar,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            notifications.unshift(notification);
            saveNotifications();
            renderNotifications();
            renderProfiles();
            
            // Animación
            const icon = e.currentTarget.querySelector('i');
            icon.classList.remove('fa-heart');
            icon.classList.add('fa-heart');
            icon.style.color = '#6366F1';
            setTimeout(() => {
                icon.style.color = '';
            }, 500);
        }

        // Manejar mensaje
        function handleMessage(e) {
            e.stopPropagation();
            const userId = e.currentTarget.getAttribute('data-id');
            const user = users.find(u => u.id === userId);
            
            // Crear notificación de chat
            const notification = {
                id: Date.now().toString(),
                type: 'message',
                userId: userId,
                userName: user.nombre,
                userAvatar: user.avatar,
                message: '¿Te gustaría conocernos?',
                timestamp: new Date().toISOString(),
                read: false
            };
            
            notifications.unshift(notification);
            saveNotifications();
            renderNotifications();
            renderProfiles();
            
            alert(`Mensaje enviado a ${user.nombre}. Pronto podrás conversar en la pestaña de mensajes.`);
        }

        // Renderizar notificaciones
        function renderNotifications() {
            const unreadCount = notifications.filter(n => !n.read).length;
            notificationCount.textContent = unreadCount > 0 ? unreadCount.toString() : '0';
            
            const notificationsList = document.getElementById('notificationsList');
            if (!notifications.length) {
                notificationsList.innerHTML = `
                    <div class="p-8 text-center">
                        <i class="fas fa-bell-slash text-4xl text-gray-500 mb-4"></i>
                        <p class="text-gray-400">No tienes notificaciones</p>
                    </div>
                `;
                return;
            }
            
            notificationsList.innerHTML = notifications.map(notification => {
                const time = new Date(notification.timestamp);
                const now = new Date();
                const minutesAgo = Math.floor((now - time) / 60000);
                const hoursAgo = Math.floor(minutesAgo / 60);
                const daysAgo = Math.floor(hoursAgo / 24);
                
                let timeText;
                if (daysAgo > 0) {
                    timeText = `${daysAgo}d`;
                } else if (hoursAgo > 0) {
                    timeText = `${hoursAgo}h`;
                } else {
                    timeText = `${minutesAgo}m`;
                }
                
                let content;
                if (notification.type === 'like') {
                    content = `
                        <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center text-white text-sm">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm text-white"><strong>${notification.userName}</strong> te dio "Me gusta"</p>
                            <p class="text-xs text-gray-400">${timeText} atrás</p>
                        </div>
                    `;
                } else if (notification.type === 'message') {
                    content = `
                        <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center text-white text-sm">
                            <i class="fas fa-comment"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm text-white"><strong>${notification.userName}</strong> inició una conversación</p>
                            <p class="text-xs text-gray-400 truncate">${notification.message}</p>
                            <p class="text-xs text-gray-400 mt-1">${timeText} atrás</p>
                        </div>
                    `;
                }
                
                return `
                    <div class="flex items-start space-x-3 p-3 ${notification.read ? 'bg-gray-700' : 'bg-gray-700'} rounded-lg mb-2 notification-item" data-id="${notification.id}">
                        ${content}
                    </div>
                `;
            }).join('');
            
            // Añadir eventos a las notificaciones
            document.querySelectorAll('.notification-item').forEach(item => {
                item.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    markNotificationAsRead(id);
                });
            });
        }

        // Marcar notificación como leída
        function markNotificationAsRead(id) {
            const notification = notifications.find(n => n.id === id);
            if (notification && !notification.read) {
                notification.read = true;
                saveNotifications();
                renderNotifications();
                renderProfiles();
            }
        }

        // Marcar todas como leídas
        document.getElementById('markAllRead').addEventListener('click', function() {
            notifications.forEach(n => n.read = true);
            saveNotifications();
            renderNotifications();
        });

        // Guardar notificaciones
        function saveNotifications() {
            // Mantener solo las últimas 50 notificaciones
            if (notifications.length > 50) {
                notifications = notifications.slice(0, 50);
            }
            localStorage.setItem('notifications', JSON.stringify(notifications));
        }

        // Mostrar perfil
        document.getElementById('profileBtn').addEventListener('click', function() {
            if (!currentUser) {
                loginModal.style.display = 'block';
                return;
            }
            
            showProfile();
            profileModal.style.display = 'block';
        });

        function showProfile() {
            const profileContent = document.getElementById('profileContent');
            profileContent.innerHTML = `
                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full mx-auto mb-4 flex items-center justify-center text-white text-2xl font-bold">
                        ${currentUser.nombre.charAt(0)}
                    </div>
                    <h3 class="text-xl font-bold text-white">${currentUser.nombre}</h3>
                    <p class="text-gray-300">${currentUser.edad}</p>
                    <p class="text-gray-400 text-sm">Miembro desde ${new Date(currentUser.createdAt).toLocaleDateString()}</p>
                </div>
                
                <div class="bg-gray-700 rounded-xl p-4 mb-4">
                    <h4 class="font-semibold text-white mb-3 flex items-center">
                        <i class="fas fa-venus-mars mr-2"></i> Género
                    </h4>
                    <div class="flex flex-wrap gap-2">
                        ${currentUser.genero.map(genero => `
                            <span class="badge interest-badge">${genero}</span>
                        `).join('')}
                    </div>
                </div>
                
                <div class="bg-gray-700 rounded-xl p-4 mb-4">
                    <h4 class="font-semibold text-white mb-3 flex items-center">
                        <i class="fas fa-user-tag mr-2"></i> Rol
                    </h4>
                    <div class="flex flex-wrap gap-2">
                        ${currentUser.rol.map(rol => `
                            <span class="badge rol-badge">${rol}</span>
                        `).join('')}
                    </div>
                </div>
                
                <div class="bg-gray-700 rounded-xl p-4 mb-4">
                    <h4 class="font-semibold text-white mb-3 flex items-center">
                        <i class="fas fa-users mr-2"></i> Tribus
                    </h4>
                    <div class="flex flex-wrap gap-2">
                        ${currentUser.tribu.map(tribu => `
                            <span class="badge tribu-badge">${tribu}</span>
                        `).join('')}
                    </div>
                </div>
                
                <div class="bg-gray-700 rounded-xl p-4 mb-4">
                    <h4 class="font-semibold text-white mb-3 flex items-center">
                        <i class="fas fa-heart mr-2"></i> Preferencias
                    </h4>
                    <div class="flex flex-wrap gap-2">
                        ${currentUser.preferencia.map(preferencia => `
                            <span class="badge preferencia-badge">${preferencia}</span>
                        `).join('')}
                    </div>
                </div>
                
                ${currentUser.descripcion ? `
                <div class="bg-gray-700 rounded-xl p-4 mb-4">
                    <h4 class="font-semibold text-white mb-3">Sobre mí</h4>
                    <p class="text-gray-300">${currentUser.descripcion}</p>
                </div>
                ` : ''}
                
                <div class="bg-gray-700 rounded-xl p-4">
                    <h4 class="font-semibold text-white mb-3">Estadísticas</h4>
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div>
                            <div class="text-2xl font-bold text-purple-400">${notifications.filter(n => n.type === 'like').length}</div>
                            <div class="text-xs text-gray-400">Likes</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-green-400">${notifications.filter(n => n.type === 'message').length}</div>
                            <div class="text-xs text-gray-400">Mensajes</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-blue-400">${users.length - 1}</div>
                            <div class="text-xs text-gray-400">Usuarios vistos</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Cerrar perfil
        document.getElementById('closeProfile').addEventListener('click', function() {
            profileModal.style.display = 'none';
        });

        // Editar perfil
        document.getElementById('editProfileBtn').addEventListener('click', function() {
            if (!currentUser) return;
            
            // Rellenar el formulario con los datos actuales
            document.getElementById('editNombre').value = currentUser.nombre;
            document.getElementById('editEdad').value = currentUser.edad;
            
            // Género
            const editGenero = document.getElementById('editGenero');
            editGenero.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = currentUser.genero.includes(cb.value);
            });
            
            // Rol
            const editRol = document.getElementById('editRol');
            editRol.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = currentUser.rol.includes(cb.value);
            });
            
            // Tribu
            const editTribu = document.getElementById('editTribu');
            editTribu.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = currentUser.tribu.includes(cb.value);
            });
            
            // Preferencia
            const editPreferencia = document.getElementById('editPreferencia');
            editPreferencia.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = currentUser.preferencia.includes(cb.value);
            });
            
            document.getElementById('editDescripcion').value = currentUser.descripcion || '';
            
            editProfileModal.style.display = 'block';
            profileModal.style.display = 'none';
        });

        // Cerrar edición de perfil
        document.getElementById('closeEditProfile').addEventListener('click', function() {
            editProfileModal.style.display = 'none';
        });
        
        document.getElementById('cancelEdit').addEventListener('click', function() {
            editProfileModal.style.display = 'none';
        });

        // Guardar edición de perfil
        document.getElementById('editProfileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nombre = document.getElementById('editNombre').value;
            const edad = document.getElementById('editEdad').value;
            
            // Obtener arrays de checkboxes
            const genero = Array.from(document.querySelectorAll('#editGenero input[type="checkbox"]:checked')).map(cb => cb.value);
            const rol = Array.from(document.querySelectorAll('#editRol input[type="checkbox"]:checked')).map(cb => cb.value);
            const tribu = Array.from(document.querySelectorAll('#editTribu input[type="checkbox"]:checked')).map(cb => cb.value);
            const preferencia = Array.from(document.querySelectorAll('#editPreferencia input[type="checkbox"]:checked')).map(cb => cb.value);
            const descripcion = document.getElementById('editDescripcion').value;
            
            // Validaciones
            if (genero.length === 0) {
                alert('Por favor selecciona al menos un género');
                return;
            }
            if (rol.length === 0) {
                alert('Por favor selecciona al menos un rol');
                return;
            }
            if (tribu.length === 0) {
                alert('Por favor selecciona al menos una tribu');
                return;
            }
            if (preferencia.length === 0) {
                alert('Por favor selecciona al menos una preferencia');
                return;
            }

            currentUser.nombre = nombre;
            currentUser.edad = edad;
            currentUser.genero = genero;
            currentUser.rol = rol;
            currentUser.tribu = tribu;
            currentUser.preferencia = preferencia;
            currentUser.descripcion = descripcion;
            currentUser.lastActive = new Date().toISOString();
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            editProfileModal.style.display = 'none';
            showProfile();
            profileModal.style.display = 'block';
            renderProfiles();
        });

        // Cerrar sesión
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('notifications');
                currentUser = null;
                notifications = [];
                location.reload();
            }
        });

        // Filtros
        document.getElementById('filterBtn').addEventListener('click', function() {
            // Rellenar los checkboxes con los filtros actuales
            const filterGenero = document.getElementById('filterGenero');
            filterGenero.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = filters.genero.includes(cb.value);
            });
            
            const filterRol = document.getElementById('filterRol');
            filterRol.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = filters.rol.includes(cb.value);
            });
            
            const filterTribu = document.getElementById('filterTribu');
            filterTribu.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = filters.tribu.includes(cb.value);
            });
            
            const filterPreferencia = document.getElementById('filterPreferencia');
            filterPreferencia.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = filters.preferencia.includes(cb.value);
            });
            
            document.getElementById('distanceFilter').value = filters.distance;
            document.getElementById('ageFilter').value = filters.age;
            
            filterModal.style.display = 'block';
        });

        document.getElementById('closeFilter').addEventListener('click', function() {
            filterModal.style.display = 'none';
        });

        document.getElementById('applyFilters').addEventListener('click', function() {
            filters.distance = parseInt(document.getElementById('distanceFilter').value);
            filters.age = document.getElementById('ageFilter').value;
            filters.genero = Array.from(document.querySelectorAll('#filterGenero input[type="checkbox"]:checked'))
                .map(cb => cb.value);
            filters.rol = Array.from(document.querySelectorAll('#filterRol input[type="checkbox"]:checked'))
                .map(cb => cb.value);
            filters.tribu = Array.from(document.querySelectorAll('#filterTribu input[type="checkbox"]:checked'))
                .map(cb => cb.value);
            filters.preferencia = Array.from(document.querySelectorAll('#filterPreferencia input[type="checkbox"]:checked'))
                .map(cb => cb.value);
            
            filterModal.style.display = 'none';
            renderProfiles();
        });

        document.getElementById('resetFilters').addEventListener('click', function() {
            document.getElementById('distanceFilter').value = '10';
            document.getElementById('ageFilter').value = '26-35';
            document.querySelectorAll('#filterModal input[type="checkbox"]').forEach(cb => cb.checked = false);
            filters = {
                distance: 10,
                age: '26-35',
                genero: [],
                rol: [],
                tribu: [],
                preferencia: []
            };
            renderProfiles();
        });

        // Notificaciones
        document.getElementById('notificationsBtn').addEventListener('click', function() {
            notificationsModal.style.display = 'block';
        });

        document.getElementById('closeNotifications').addEventListener('click', function() {
            notificationsModal.style.display = 'none';
        });

        // Pestañas
        document.getElementById('tabNearby').addEventListener('click', function() {
            document.getElementById('tabNearby').className = 'tab-active flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1';
            document.getElementById('tabMessages').className = 'tab-inactive flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1';
            document.getElementById('tabProfile').className = 'tab-inactive flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1';
            // El contenido de cercanos ya está visible
        });

        document.getElementById('tabMessages').addEventListener('click', function() {
            document.getElementById('tabNearby').className = 'tab-inactive flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1';
            document.getElementById('tabMessages').className = 'tab-active flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1';
            document.getElementById('tabProfile').className = 'tab-inactive flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1';
            
            profilesContainer.innerHTML = `
                <div class="p-8 text-center">
                    <i class="fas fa-comments text-4xl text-gray-500 mb-4"></i>
                    <p class="text-white mb-4">Mensajes</p>
                    <p class="text-sm text-gray-400">Aquí verás tus conversaciones</p>
                </div>
            `;
        });

        document.getElementById('tabProfile').addEventListener('click', function() {
            document.getElementById('tabNearby').className = 'tab-inactive flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1';
            document.getElementById('tabMessages').className = 'tab-inactive flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1';
            document.getElementById('tabProfile').className = 'tab-active flex-1 py-4 text-sm font-medium flex items-center justify-center space-x-1';
            
            if (!currentUser) {
                loginModal.style.display = 'block';
                return;
            }
            
            profilesContainer.innerHTML = `
                <div class="p-8 text-center">
                    <div class="w-24 h-24 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full mx-auto mb-4 flex items-center justify-center text-white text-3xl font-bold">
                        ${currentUser.nombre.charAt(0)}
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">${currentUser.nombre}</h3>
                    <p class="text-gray-300 mb-4">${currentUser.edad}</p>
                    
                    <div class="space-y-3 mb-6">
                        <div class="bg-gray-700 rounded-xl p-3">
                            <h4 class="font-semibold text-white text-sm mb-2">Género</h4>
                            <div class="flex flex-wrap justify-center gap-2">
                                ${currentUser.genero.map(genero => `
                                    <span class="badge interest-badge text-xs">${genero}</span>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="bg-gray-700 rounded-xl p-3">
                            <h4 class="font-semibold text-white text-sm mb-2">Rol</h4>
                            <div class="flex flex-wrap justify-center gap-2">
                                ${currentUser.rol.map(rol => `
                                    <span class="badge rol-badge text-xs">${rol}</span>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="bg-gray-700 rounded-xl p-3">
                            <h4 class="font-semibold text-white text-sm mb-2">Tribus</h4>
                            <div class="flex flex-wrap justify-center gap-2">
                                ${currentUser.tribu.map(tribu => `
                                    <span class="badge tribu-badge text-xs">${tribu}</span>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="bg-gray-700 rounded-xl p-3">
                            <h4 class="font-semibold text-white text-sm mb-2">Preferencias</h4>
                            <div class="flex flex-wrap justify-center gap-2">
                                ${currentUser.preferencia.map(preferencia => `
                                    <span class="badge preferencia-badge text-xs">${preferencia}</span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <button id="editProfileBtnFooter" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg mr-2">
                        <i class="fas fa-edit mr-1"></i> Editar
                    </button>
                    <button id="logoutBtnFooter" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-lg">
                        <i class="fas fa-sign-out-alt mr-1"></i> Salir
                    </button>
                </div>
            `;
            
            document.getElementById('editProfileBtnFooter').addEventListener('click', function() {
                if (!currentUser) return;
                
                // Rellenar el formulario con los datos actuales
                document.getElementById('editNombre').value = currentUser.nombre;
                document.getElementById('editEdad').value = currentUser.edad;
                
                // Género
                const editGenero = document.getElementById('editGenero');
                editGenero.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = currentUser.genero.includes(cb.value);
                });
                
                // Rol
                const editRol = document.getElementById('editRol');
                editRol.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = currentUser.rol.includes(cb.value);
                });
                
                // Tribu
                const editTribu = document.getElementById('editTribu');
                editTribu.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = currentUser.tribu.includes(cb.value);
                });
                
                // Preferencia
                const editPreferencia = document.getElementById('editPreferencia');
                editPreferencia.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = currentUser.preferencia.includes(cb.value);
                });
                
                document.getElementById('editDescripcion').value = currentUser.descripcion || '';
                
                editProfileModal.style.display = 'block';
            });
            
            document.getElementById('logoutBtnFooter').addEventListener('click', function() {
                if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('notifications');
                    currentUser = null;
                    notifications = [];
                    location.reload();
                }
            });
        });

        // Búsqueda
        searchInput.addEventListener('input', function() {
            renderProfiles();
        });

        // Actualizar ubicación periódicamente
        setInterval(function() {
            if (locationEnabled && currentUser) {
                updateUserLocation();
            }
        }, 30000); // Cada 30 segundos

        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            if (event.target === loginModal) {
                loginModal.style.display = 'none';
            }
            if (event.target === profileModal) {
                profileModal.style.display = 'none';
            }
            if (event.target === editProfileModal) {
                editProfileModal.style.display = 'none';
            }
            if (event.target === filterModal) {
                filterModal.style.display = 'none';
            }
            if (event.target === notificationsModal) {
                notificationsModal.style.display = 'none';
            }
        };
    </script>
</body>
</html>
